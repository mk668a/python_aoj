問2　カラオケのレジを開発しろ！

あなたは、カラオケチェーンのシステムエンジニアとして、レジの計算を行うプログラムを開発することになった。担当箇所は、一つの団体が一つのカラオケルームに入室して全員がそのカラオケルームから出るまでの記録をもとに、その団体の払うべき料金を計算する箇所である。

このカラオケチェーンにおける料金の計算方法は、大まかには以下である。

カラオケの料金は、カラオケルームの使用料金 (以下ルーム料金) 、ドリンク代、フード代の三つに分類される。

団体のチェックイン時に、時間種別とドリンクコースを一つずつ選択する。

時間種別には二種類あり、三十分毎課金とフリータイムである。
三十分毎課金では、それぞれの人が 3030 分毎に、予め決められたルーム料金を払う。
フリータイムでは、それぞれの人が入室時に、予め決められたルーム料金を払う。はじめの一回以外で、ルーム料金は発生しない。
ドリンクコースには三種類あり、ワンドリンクとソフトドリンク 飲み放題とアルコール 飲み放題である。
ワンドリンクでは、退室までに注文されたドリンクの総個数が、入室総人数以上にならなければいけないコースである。
ソフトドリンク 飲み放題とアルコール 飲み放題では、ドリンクの料金は無料である。
ワンドリンクでは、ドリンクの料金は注文の都度発生する。
一度時間種別とドリンクコースが選ばれたら、その団体がチェックアウトするまでこれらを変更することはできない。
カラオケルームへの入退室が頻繁に行われる可能性があるため、特殊な料金計算がなされる。

入退室が頻繁に行われる中、団体の誰が入室して退室したかを個人レベルで追跡することは不可能である。
そこでこのカラオケチェーンのシステムでは、団体の誰かが退室した場合、カラオケルームにいる人のうち、最も入店時刻が早かった人が退出したものとみなして料金計算を行う。
時間帯がデイタイムとナイトタイムの二つに分かれており、それらに対応した二つの料金テーブルがある。ナイトタイムでは料金が高くなる。

カラオケルームの最大収容人数は、999999 人である。

上記の説明では、料金の具体的な発生タイミングや具体的な金額はまだ書かれていないことに注意せよ。

本システムは金銭に関わるため、詳細な仕様を理解して正確に実装する必要がある。下記の「詳細な仕様」に基づいて、レジに入力された入退室・ドリンク注文・フード注文の記録を元に、団体が払うべき料金を計算するプログラムを作成せよ。

詳細な仕様
時刻
時刻はhh:mm:ss形式である。

hh は 08 〜 31 である。24を超える時刻は、深夜営業に対応している。
mm は 00 〜 59 である。
ss は 00 〜 59 である。
規定の桁数に満たない場合は 0 で埋められる
時間帯はデイナイトとナイトタイムの二つに分かれており、それぞれの時間帯は以下のように定義される。

デイタイム: 17:49:59とそれより前
ナイトタイム: 17:50:00とそれより後
レコード
レジに入力された団体のカラオケルームでの記録は、レコードによって管理されている。レコードは、スペース区切りで分割されたいくつかの情報が一行で記載されたものである。

レコードは、ヘッダレコード (header)、入室レコード (enter)、退室レコード (leave)、ドリンク注文レコード (drink)、フード注文レコード (food)、フッタレコード (footer) の 66 つのレコード種に大別される。レコードは、時刻とレコード種と、そのレコード種に特有な特有情報の 33 つで構成されている。それぞれのレコード種の目的と特有情報は、以下の通りである。

ヘッダレコード (header)

団体の時間種別とドリンクコースを指定するための、チェックインの時に一回だけ記録されるレコードである。
特有情報は、時間種別とドリンクコースである。
レコードは、一行でスペース区切りで時刻・レコード種・時間種別・ドリンクコースが記載される。
時間種別は、free_timeがフリータイムを表し、time_basedが三十分毎課金を表す。
ドリンクコースは、one_drinkがワンドリンクを表し、free_refillsがソフトドリンク 飲み放題を表し、alcohol_free_refillsがアルコール 飲み放題を表す。
ヘッダレコードの例は以下である。この例では、団体が時刻12:34:56に三十分毎課金のアルコール 飲み放題コースでカラオケルームを予約したことを表す。
12:34:56 header time_based free_refills
入室レコード (enter)

カラオケルームに人が入室したイベントを記録するためのレコードである。
特有情報は、入室人数である。
入室人数は、11 以上 999999 以下の整数である。
入室レコードは、一行でスペース区切りで時刻・レコード種・入室人数が記載される。
入室レコードの例は以下である。この例では、時刻12:34:56に、カラオケルームに 33 人が入室したことをあらわす。
12:34:56 enter 3
退室レコード (leave)

カラオケルームから人が退室したイベントを記録するためのレコードである。
特有情報は、退室人数である。
退室人数は、11 以上 999999 以下の整数である。
退室レコードは、一行でスペース区切りで時刻・レコード種・退室人数が記載される。
退室レコードの例は以下である。この例では、時刻15:23:46に、カラオケルームから 11 人が退室したことをあらわす。
15:23:46 leave 1
退室レコードの時点でカラオケルームにいる人のうち、最も入店時刻が早かった人から、退室人数だけ退室したものとみなす。
退出レコード後にカラオケルームにいる人数が 00 人となっている状態であっても、入室レコード・ドリンク注文レコード・フード注文レコードが与えられる可能性がある。
ドリンク注文レコード (drink)

団体がソフトドリンクもしくはアルコールを注文するイベントを記録するためのレコードである。
特有情報は、ドリンクの単価と数量である。
単価は、11 ドリンクあたりの料金 (円) を表す。11 以上 99999999 以下の整数である。
数量は、11 以上 9999 以下の整数である。
ドリンク注文レコードは、一行でスペース区切りで時刻・レコード種・単価・数量が記載される。
ドリンク注文コードの例は以下である。この例では、15:23:46に、340340 円のドリンクを 22 つ注文したことを表す。
15:23:46 drink 340 2
ドリンクがソフトドリンクかアルコールかは特有情報に含まれないが、これは全ドリンクコースでこの情報が料金計算のために必要ないためである。
ワンドリンク制であれば、ソフトドリンクかアルコールかは無関係に料金を払う必要があるため、ドリンクがソフトドリンクかアルコールかは料金計算のために必要ない。
ソフトドリンク 飲み放題もしくはアルコール 飲み放題の場合、ドリンク料金はドリンクの値段によらず無料である。
フード注文レコード (food)

団体がフードを注文するイベントを記録するためのレコードである。
特有情報は、フードの単価と数量である。
単価は、11 フードあたりの料金 (円) を表す。11 以上 99999999 以下の整数である。
数量は、11 以上 9999 以下の整数である。
フード注文レコードは、一行でスペース区切りで時刻・レコード種・単価・数量が記載される。
フード注文コードの例は以下である。この例では、15:23:46に、870870 円のフードを 22 つ注文したことを表す。
15:23:46 food 870 2
フッタレコード (footer)

その団体の全員が退店し、カラオケの料金を支払うことを表す、チェックアウトの時に一回だけ記録されるレコードである。
特有情報はない。
フッタレコードは、一行でスペース区切りで時刻・レコード種が記載される。
フッタレコードの例は以下である。この例では、時刻21:34:56に団体がカラオケ料金を払って全員が退出したことを表す。
21:34:56 footer
正常なレコードは以下の条件を満たす行である。逆に、以下を満たさないレコードは不正なレコードである。

時刻とレコード種と特有情報が、一つのスペースによって区切られている。
行頭・行末に空白文字が含まれない。
存在するレコード種が指定されている。
時刻および特有情報が、制約を満たす。
料金の計算方法
カラオケルームの料金は、ルーム料金とドリンク料金とフード料金を合算したものである。

ルーム料金
ルーム料金は、カラオケに入室したそれぞれの人ごとに計算される一人あたりの料金を合計したものである。一人あたりの料金は、時間種別、ドリンクコースおよび時間帯によって異なり、以下のように計算される。

時間種別がフリータイムである場合は、以下によってルーム料金を計算する。
入室時の時刻で、デイタイムかナイトタイムかの時間帯の判定をする。
一人あたりの料金は、その人が入室したときの時間帯とドリンクコースによって、以下の表から決められる。
時間種別	ドリンクコース	時間帯	料金
フリータイム	ワンドリンク	デイタイム	1000 円
ナイトタイム	1500 円
ソフトドリンク 飲み放題	デイタイム	1500 円
ナイトタイム	2000 円
アルコール 飲み放題	デイタイム	2500 円
ナイトタイム	4000 円
時間毎料金
一人あたりの料金の加算は、入室時刻と入室時刻から 30 分ごとに発生する可能性がある。
入室時刻では、必ず料金が発生する。
入室時刻よりあとで入室時刻から 30 分ごとのタイミングでは、その人の退室時刻がそのタイミングの 10 分以上後である場合は料金が発生する。逆にそうでない場合、超過時間は咎めず、そのタイミングでの一人あたりの料金は加算しない。
上記のタイミングで一人あたりの料金が加算された場合、加算量は、そのタイミングでの時間帯とドリンクコースによって以下の表から決められる。
例: 17:23:00 入室、18:30:20 退室・30分ごと、ソフトドリンク飲み放題の場合
17:23:00: 入室時刻なので料金が加算される。この加算量は、ソフトドリンク 飲み放題 デイタイム であるため、200200 円が加算される。
17:53:00: 入室時刻から 3030 分のタイミングなので料金が加算される。この加算量は、ソフトドリンク 飲み放題 ナイトタイム であるため、500500 円である。
18:23:00: 入室時刻から 6060 分のタイミングだが、あと 77 分 2020 秒でこの人は退出する。超過時間が 1010 分未満であるため、超過時間は咎めず料金は加算しない。
上記からこの例では、一人あたりの料金は 700 = 200 + 500700=200+500 円である。
時間種別	ドリンクコース	時間帯	料金
30 分ごと	ワンドリンク	デイタイム	100 円 / 30分
ナイトタイム	400 円 / 30分
ソフトドリンク 飲み放題	デイタイム	200 円 / 30分
ナイトタイム	500 円 / 30分
アルコール 飲み放題	デイタイム	300 円 / 30分
ナイトタイム	650 円 / 30分
ドリンク料金
ドリンク料金は、団体が注文したドリンクの料金の総額である。

ドリンクコースがワンドリンクの場合、ドリンク注文レコードに記載された単価と数量の積の総和である。
ドリンクコースがソフトドリンク 飲み放題もしくはアルコール 飲み放題の場合、ドリンク料金はコースに含まれているので、レコードに記載されている単価・数量にかかわらずドリンク料金は 00 円である。
フード料金
フード料金は、団体が注文したフードの料金の総額である。

フード注文レコードに記載された単価と数量の積の総和である。
入力
プログラムに与えられる入力は、nn 行にわたって標準入力に入力される (ただし、nn は総レコード数)。
各行が正常なレコードであり、不正なレコードを含まない。
各行は、時刻昇順に並んだレコードである。
同じ時刻のレコードは存在しない。
全てのレコードの末尾には改行コード<LF>が付与される
最終行 (最終レコード末尾の改行コードの後) を除いて空行は存在しない
11 行目はヘッダレコードである。
ヘッダレコードとフッタレコードは、ちょうど 11 つしか存在しない。
22 行目は入室レコードである。
最終行はフッタレコードである。
上記に反する入力は、不正な入力である。
このチャレンジで与えられるテストケースは、その行数が 10001000 行以下であることが保障される。
つまり、10001000 行を超える入力は与えられないので、受験者は行数が 10001000 行を超える入力考慮する必要はなく、不正な入力として処理する必要もなく当然ない。
出力
入力の不正や入力ミスを検知するため、プログラムは 44 種類の JSON 形式のオブジェクトのうち一つを適切に選び、標準出力に出力せよ。

44 種類のどの JSON オブジェクトにもcodeフィールドが含まれており、codeで種別を区別する。コードと種別の対応は以下である。

不正な入力エラー (code : 999)
端末操作エラー (code : 99)
ワンドリンクエラー (code : 1)
正常 (code : 0)
適切な JSON 形式であれば、オブジェクトのプロパティ順序、空白・改行の有無やそれらの個数は問わない。ただし、指示されていないプロパティが含まれている場合は、誤答とみなされるので注意せよ。

プログラムそのものは終了コード 0 で終了しなければならない。

不正な入力エラー
入力が不正な入力である場合、プログラムは以下の JSON オブジェクトを出力する。
{
  "code": 999
}
端末操作エラー
不正な入力エラーではなく、以下の条件のいずれかが満たされた場合は、そのようなレコードは団体もしくはカラオケチェーンの店員による端末操作エラーであるとみなす。

ある入室レコードにおいて、入室人数の総計が 1000 人以上になった場合
ある退室レコードにおいて、それまでの退室レコードの人数の総計が、それまでの入室レコードの人数総計以上になった場合
端末操作エラーがある場合、プログラムは以下の JSON オブジェクトを出力する。

{
  "code": 99
}
ワンドリンクエラー
不正な入力エラーでも端末操作エラーでもなく、ドリンクコースがワンドリンクでかつドリンクの総注文数が総入室人数を下回っている場合は、ワンドリンクエラーとみなす。

ワンドリンクエラーの場合、プログラムは以下の JSON オブジェクトを出力する。

code: 整数 1
price: 整数。ドリンクの総注文数の不足を仮に許容して計算した場合の料金 (円)
drink: 整数。不足したドリンクの注文数。総入室人数からドリンクの総注文数を引いた整数。
{
  "code": 1,
  "price": 5000,
  "drink": 10
}
正常
不正な入力エラーでも端末操作エラーでもワンドリンクエラーでもない場合、以下の JSON オブジェクトを出力する。
出力
code: 整数 0
price: 整数。団体が支払うべき料金 (円)
{
  "code": 0,
  "price": 5000
}
コマンドラインアプリケーション(CLI アプリ)作成用テンプレート(Python3.x)
main.pyを編集して、CLIアプリを実装してください。
チャレンジ内でファイルの作成が許可されていれば、可読性等のためにファイルを分割する事も可能です。

標準入力の取得方法
main.py内で定義されている、mainという関数から、 lines の名前で取得可能です。

def main(lines):
    # code to run
ここでの lines は sys.stdin の内容が入ります。

コマンド実行結果の標準出力への出力
stdoutへの出力は標準のprintメソッドが使用可能です。

print(result)
外部ライブラリの追加方法
外部ライブラリを使用する場合は以下の手順で実施してください。

requirements.txtにライブラリ名とバージョンを記述
例:
numpy==1.11.0
requests==2.12.4